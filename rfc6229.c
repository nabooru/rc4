
/* Test vectors for the stream cipher RC4 */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdint.h>
#include "rc4.h"


typedef struct keystream {
   size_t length;
   const uint8_t key[16];
} keystream_t;

typedef struct vector {
   size_t        offset;
   const uint8_t keystream[16];
} vector_t;

struct rfc6229_vector {
   keystream_t keystream;
   vector_t    vector[18]; 
} rfc6229_vector[3] = { 

   { 40, "\x01\x02\x03\x04\x05",
     0x0000, "\xb2\x39\x63\x05\xf0\x3d\xc0\x27\xcc\xc3\x52\x4a\x0a\x11\x18\xa8", 
     0x0010, "\x69\x82\x94\x4f\x18\xfc\x82\xd5\x89\xc4\x03\xa4\x7a\x0d\x09\x19",
     0x00f0, "\x28\xcb\x11\x32\xc9\x6c\xe2\x86\x42\x1d\xca\xad\xb8\xb6\x9e\xae",
     0x0100, "\x1c\xfc\xf6\x2b\x03\xed\xdb\x64\x1d\x77\xdf\xcf\x7f\x8d\x8c\x93",
     0x01f0, "\x42\xb7\xd0\xcd\xd9\x18\xa8\xa3\x3d\xd5\x17\x81\xc8\x1f\x40\x41",
     0x0200, "\x64\x59\x84\x44\x32\xa7\xda\x92\x3c\xfb\x3e\xb4\x98\x06\x61\xf6",  
     0x02f0, "\xec\x10\x32\x7b\xde\x2b\xee\xfd\x18\xf9\x27\x76\x80\x45\x7e\x22",
     0x0300, "\xeb\x62\x63\x8d\x4f\x0b\xa1\xfe\x9f\xca\x20\xe0\x5b\xf8\xff\x2b", 
     0x03f0, "\x45\x12\x90\x48\xe6\xa0\xed\x0b\x56\xb4\x90\x33\x8f\x07\x8d\xa5",
     0x0400, "\x30\xab\xbc\xc7\xc2\x0b\x01\x60\x9f\x23\xee\x2d\x5f\x6b\xb7\xdf",
     0x05f0, "\x32\x94\xf7\x44\xd8\xf9\x79\x05\x07\xe7\x0f\x62\xe5\xbb\xce\xea",
     0x0600, "\xd8\x72\x9d\xb4\x18\x82\x25\x9b\xee\x4f\x82\x53\x25\xf5\xa1\x30",
     0x07f0, "\x1e\xb1\x4a\x0c\x13\xb3\xbf\x47\xfa\x2a\x0b\xa9\x3a\xd4\x5b\x8b",
     0x0800, "\xcc\x58\x2f\x8b\xa9\xf2\x65\xe2\xb1\xbe\x91\x12\xe9\x75\xd2\xd7",
     0x0bf0, "\xf2\xe3\x0f\x9b\xd1\x02\xec\xbf\x75\xaa\xad\xe9\xbc\x35\xc4\x3c",
     0x0c00, "\xec\x0e\x11\xc4\x79\xdc\x32\x9d\xc8\xda\x79\x68\xfe\x96\x56\x81",
     0x0ff0, "\x06\x83\x26\xa2\x11\x84\x16\xd2\x1f\x9d\x04\xb2\xcd\x1c\xa0\x50", 
     0x1000, "\xff\x25\xb5\x89\x95\x99\x67\x07\xe5\x1f\xbd\xf0\x8b\x34\xd8\x75" },

   { 56, "\x01\x02\x03\x04\x05\x06\x07",
     0x0000, "\x29\x3f\x02\xd4\x7f\x37\xc9\xb6\x33\xf2\xaf\x52\x85\xfe\xb4\x6b",
     0x0010, "\xe6\x20\xf1\x39\x0d\x19\xbd\x84\xe2\xe0\xfd\x75\x20\x31\xaf\xc1",
     0x00f0, "\x91\x4f\x02\x53\x1c\x92\x18\x81\x0d\xf6\x0f\x67\xe3\x38\x15\x4c",
     0x0100, "\xd0\xfd\xb5\x83\x07\x3c\xe8\x5a\xb8\x39\x17\x74\x0e\xc0\x11\xd5",
     0x01f0, "\x75\xf8\x14\x11\xe8\x71\xcf\xfa\x70\xb9\x0c\x74\xc5\x92\xe4\x54",
     0x0200, "\x0b\xb8\x72\x02\x93\x8d\xad\x60\x9e\x87\xa5\xa1\xb0\x79\xe5\xe4",
     0x02f0, "\xc2\x91\x12\x46\xb6\x12\xe7\xe7\xb9\x03\xdf\xed\xa1\xda\xd8\x66",
     0x0300, "\x32\x82\x8f\x91\x50\x2b\x62\x91\x36\x8d\xe8\x08\x1d\xe3\x6f\xc2",
     0x03f0, "\xf3\xb9\xa7\xe3\xb2\x97\xbf\x9a\xd8\x04\x51\x2f\x90\x63\xef\xf1",
     0x0400, "\x8e\xcb\x67\xa9\xba\x1f\x55\xa5\xa0\x67\xe2\xb0\x26\xa3\x67\x6f",
     0x05f0, "\xd2\xaa\x90\x2b\xd4\x2d\x0d\x7c\xfd\x34\x0c\xd4\x58\x10\x52\x9f",
     0x0600, "\x78\xb2\x72\xc9\x6e\x42\xea\xb4\xc6\x0b\xd9\x14\xe3\x9d\x06\xe3",
     0x07f0, "\xf4\x33\x2f\xd3\x1a\x07\x93\x96\xee\x3c\xee\x3f\x2a\x4f\xf0\x49",
     0x0800, "\x05\x45\x97\x81\xd4\x1f\xda\x7f\x30\xc1\xbe\x7e\x12\x46\xc6\x23",
     0x0bf0, "\xad\xfd\x38\x68\xb8\xe5\x14\x85\xd5\xe6\x10\x01\x7e\x3d\xd6\x09",
     0x0c00, "\xad\x26\x58\x1c\x0c\x5b\xe4\x5f\x4c\xea\x01\xdb\x2f\x38\x05\xd5",
     0x0ff0, "\xf3\x17\x2c\xef\xfc\x3b\x3d\x99\x7c\x85\xcc\xd5\xaf\x1a\x95\x0c",
     0x1000, "\xe7\x4b\x0b\x97\x31\x22\x7f\xd3\x7c\x0e\xc0\x8a\x47\xdd\xd8\xb8" },

   { 64, "\x01\x02\x03\x04\x05\x06\x07\x08" ,
     0x0000, "",
     0x0010, "",
   },

};

void hexdump(uint8_t *buffer, size_t buflen)
{
   int i;
   for (i = 0; i < buflen; i++) {
       if (i % 8 == 0) printf(" "); 
       printf("%02x ", buffer[i]);
   }
}

int rfc6229_test(void)
{
   int i, j;
   rc4_state_t state;
   uint8_t buffer[4112] = { 0 };
   keystream_t *keystream = NULL;
   vector_t *vector = NULL;
   int n = 0;
   
   printf("\n");

   for (i = 0; i < 3; i++) {
       keystream = &rfc6229_vector[i].keystream;
       rc4_init(&state, keystream->key, keystream->length / 8);
       rc4_encrypt(&state, buffer, buffer, 4112);       
       printf("#%u Key length: %u \n", i+1, keystream->length); 
       printf("--------------------\n");
       for (j = 0; j < 18; j++) {
           vector = &rfc6229_vector[i].vector[j];
           printf("Offset: 0x%04X ", vector->offset);
           hexdump(buffer + vector->offset, 16);
           n = memcmp(buffer + vector->offset, vector->keystream, 16);
           printf("%s\n", !n ? " PASSED!" : " FAILED!");
       }
       printf("\n");
       memset(buffer, '\0', 4112);
   }

   return 0;
}

int main(int argc, char *argv[])
{

   rfc6229_test();

   return 0;
}